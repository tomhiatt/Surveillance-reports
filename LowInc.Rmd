---
title: 'Epidemiological Situation of Tuberculosis in the Western Pacific towards the End TB Strategy Targets: analysis of case notification data in `r yr <- 2013; yr`'
author: "Tom Hiatt<sup>&dagger;</sup> and Nobuyuki Nishikiori<sup>&dagger;</sup>"
csl: vancouver-imperial-college-london.csl
output:
  html_document:
    fig_caption: yes
    keep_md: yes
    number_sections: no
    theme: united
    toc: yes
  pdf_document:
    toc: yes
  word_document:
    fig_height: 7
bibliography: WPRupdate.bib
---

```{r setup, echo=FALSE, include=FALSE}

###################################################
# Tom Hiatt
# Updated: 12 November 2014
# Regional TB annual analysis
###################################################

## Change this information to customize for your own data.

yr <- 2013

###################################################

# > sessionInfo()

library(plyr) #Note: plyr must be loaded before dplyr
lapply(c("reshape", "plyr", "dplyr", "ggplot2", "grid", "scales", "xtable", "stringr", "ggthemes", "tidyr", "directlabels", "proto"), library, character.only=TRUE)
# proto is automatically called by direct.label.

# Reproducible research process inspired by: http://gforge.se/2014/01/fast-track-publishing-using-knitr-part-ii/

# Global options for knitr
# change this to 'postscript' for EPS output.
require(knitr)
opts_chunk$set(
  #   dev="png",
  #   dev.args=list(type="cairo"),
  #   dpi=96,
  fig.width=7,
  echo=FALSE
  )

whbc <- c("KHM", "CHN", "LAO", "MNG", "PNG", "PHL", "VNM")

# Create regional report folder if needed.
# dir.create("./Regional_report") # run this if error below
# dir.create("./figure_data") # run this if error below
if(!any(grep("Regional_report", getwd()))) setwd("./Regional_report")


# Theme for plots
theme_report <- function(base_size=12, base_family="") {
  colors <- ggthemes_data$few
  gray <- colors$medium['gray']
  black <- colors$dark['black'] # I don't know why these last 3 parts are needed, but they are. List is here: http://docs.ggplot2.org/0.9.2.1/theme.html
  theme_bw(base_size=base_size, base_family=base_family) +
    theme(
      line = element_line(colour = gray),
      rect = element_rect(fill = "white", colour = NA),
      text = element_text(colour = black),
      axis.ticks.x = element_line(colour = gray),
      axis.ticks.y = element_blank(),
      legend.key = element_rect(colour = NA),
      ## Examples do not use grid lines
      panel.border = element_rect(colour = gray),
      panel.grid.major.x = element_blank(),
      panel.grid.minor = element_blank(),
      strip.background = element_rect(fill="white", colour=NA),
      strip.text = element_text(hjust=0)
      )
  }

########################################################
# Functions for data formatting and manipulation
########################################################

# Simple rounder that just adds in the thousands separator 
rounder <- function(x, decimals=FALSE) {
  if(decimals==TRUE){
    ifelse(is.na(x), NA, ifelse(x==0, 0, ifelse(x < 0.01, "<0.01", ifelse(round(x,2) < 0.1, formatC(round(x,2), format='f', digits=2), ifelse(round(x,1) < 10, formatC(round(x,1), format='f', digits=1), formatC(round(x,0), big.mark=" ", format='d') )))))
    }
  else ifelse(is.na(x), NA, ifelse(x==0, 0, ifelse(x < 1, "< 1", formatC(round(x,0), big.mark=" ", format='d'))))
  }

.rowsums <- function(x) { 
  # This function sums rows ignoring NAs unless all are NA
  # use it like this
  # t3c$snu <- .rowsums(t3c[c('new_sn', 'new_su')])
  tosum <- as.matrix(x)
  summed <- rowMeans((tosum), na.rm=T) * rowSums(!is.na((tosum)))
  return(summed)
  }

sum0 <- function(x) sum(x, na.rm = !all(is.na(x)))

# Change names to WPSAR convention
.WPSARnames <- function(d, col='country', the=FALSE){
  d[col] <- as.character(d[[col]])
  d[col] <- ifelse(d[[col]]=='China, Hong Kong SAR', 'Hong Kong Special Administrative Region (China)', 
                   ifelse(d[[col]]=='China, Macao SAR', 'Macao Special Administrative Region (China)', 
                          ifelse(d[[col]]=='Micronesia (Federated States of)', 'Micronesia, Federated States of', 
                                 ifelse(d[[col]]=='WPR', 'Western Pacific Region
                                        ', d[[col]]))))
  
  if(the){
    d[col] <- ifelse(d[[col]]=='Philippines', 'the Philippines',
                     ifelse(d[[col]]=="Lao People's Democratic Republic", "the Lao People's Democratic Republic", d[[col]]))
    }
  
  
  return(d)
  }

lister <- function(x){
  if(length(x)==1) return(x)
  if(length(x)==2) return(paste(x, collapse=" and "))
  else return(paste(paste(x[1:(length(x)-1)], collapse=", "), x[length(x)], sep=", and "))
}

########################################################
# Functions for maps
########################################################

source("./MapFunctions.r")
load("gparts.Rdata")

########################################################
# Functions to assist with tables and figure in markdown document (from here: http://rmflight.github.io/posts/2012/10/papersinRmd.html)
########################################################

incCount <- function(inObj, useName) {
  nObj <- length(inObj)
  useNum <- max(inObj) + 1
  inObj <- c(inObj, useNum)
  names(inObj)[nObj + 1] <- useName
  inObj
  }
figCount <- c(`_` = 0)
tableCount <- c(`_` = 0)

# tableCount

pasteLabel <- function(preText, inObj, objName, insLink = TRUE, sepper = " ") {
  objNum <- inObj[objName]
  
  useText <- paste(preText, objNum, sep = sepper)
  if (insLink) {
    useText <- paste("[", useText, "](#", objName, ")", sep = "")
  }
  useText
}

tableCat <- function(inFrame) {
  outText <- paste(names(inFrame), collapse = " | ")
  outText <- c(outText, paste(rep("---", ncol(inFrame)), collapse = " | "))
  invisible(apply(inFrame, 1, function(inRow) {
    outText <<- c(outText, paste(inRow, collapse = " | "))
    }))
  return(outText)
  }

# Create directory and Get data

if(!"data" %in% dir()){
  dir.create(paste("./data"))
  stop("Download the notification and treatment outcomes data from 'http://who.int/tb/country/data/download/en/' to './data'.")
  }

data1 <- dir("./data", full.names=TRUE)
tb <- NA
for(i in data1){
  data3 <- read.csv(i)
  tb <- merge(tb, data3, all=TRUE)
  }

# Note: to use your own data, make a flat data file with each row corresponding to the lower reporting unit and a aggregating variable. EG by country with aggregating variable of region.

# Add needed variables
tb$g_hbc22 <- ifelse(tb$iso3 %in% c("AFG", "BGD", "BRA", "CHN", "COD", "ETH", "IDN", "IND", "KEN", "KHM", "MMR", "MOZ", "NGA", "PAK", "PHL", "RUS", "THA", "TZA", "UGA", "VNM", "ZAF", "ZWE"), "high", "low")

pacific <- c("ASM", "COK", "FJI", "PYF", "GUM", "KIR", "MHL", "FSM", "NRU",   "NCL", "NIU", "MNP", "PLW", "WSM", "SLB", "TKL", "TON", "TUV", "VUT", "WLF")

tb$g_wpr <- ifelse(tb$iso3 %in% whbc, "High-burden", ifelse(tb$iso3 %in% pacific, "Pacific", "Other"))
tb$g_wpr <- factor(tb$g_wpr, levels=c("High-burden", "Pacific", "Other", "WPR"))

# tb$c_new <- .rowsums(tb[c("new_sp", "new_sn", "new_su", "new_ep", "new_oth")])
tb$c_newinc <- ifelse(tb$year < 2013, .rowsums(tb[c("tot_newrel", "newret_oth")]), .rowsums(tb[c("new_labconf", "new_clindx", "new_ep", "ret_rel_labconf", "ret_rel_clindx", "ret_rel_ep")]))
tb$c_newunk <- ifelse(tb$year < 2013, .rowsums(tb[c("new_sp", "new_sn", "new_su", "new_ep", "new_oth", "newret_oth")]), .rowsums(tb[c("new_labconf", "new_clindx", "new_ep")]))
# tb$c_ret <- .rowsums(tb[c("ret_rel", "ret_taf", "ret_tad", "ret_oth")])
tb$c_notified <- ifelse(tb$year < 2013, .rowsums(tb[c("new_sp", "new_sn", "new_su", "new_ep", "new_oth", "ret_rel", "ret_taf", "ret_tad", "ret_oth", "newret_oth")]), .rowsums(tb[c("c_newinc", "ret_nrel")]))
tb$c_newrel_tsr <- tb$newrel_succ / tb$newrel_coh * 100

tb$c_newinc_100k <- tb$c_newinc / tb$e_pop_num * 1e5

# Get population data (available from UN population division. http://esa.un.org/unpd/wpp/unpp/panel_population.htm) and formatted TB/HIV data and estimates for the WHO Western Pacific Region.

if(FALSE){
  runprofile()
  esta <- subset(araw, group_name=="WPR", select=c("year", "e_pop_num", "e_inc_100k", "e_inc_100k_lo", "e_inc_100k_hi", "e_prev_100k", "e_prev_100k_lo", "e_prev_100k_hi", "e_mort_exc_tbhiv_100k", "e_mort_exc_tbhiv_100k_lo", "e_mort_exc_tbhiv_100k_hi", "e_prev_num", "e_prev_num_lo", "e_prev_num_hi"))
  tb2 <- subset(tb, select=c(iso3, year, notif_foreign))
  save(esta, p, tbhiv, tb2, file="./addata.Rdata")
}

load("./addata.Rdata")

tb <- merge(tb, tbhiv[c(3,4,13:ncol(tbhiv))], all=TRUE)
tb <- merge(tb, tb2, all.x=TRUE)

```

[TH: targets in the title is maybe not the best idea, since we have no baseline and catastrophic expenditure hasn't even been concluded how to measure.]

<sup>&dagger;</sup> Stop TB and Leprosy Elimination, Division of Communicable Diseases, World Health Organization Regional Office for the Western Pacific, Manila, Philippines.

--------------------------------------------------------

Correspondence to Tom Hiatt (e-mail: hiattt@wpro.who.int).

--------------------------------------------------------

To cite this article: 



--------------------------------------------------------

Abstract 
--------------------------------------------------------
```{r abstract, echo=FALSE}
a1 <- signif((subset(esta, year==2000, e_prev_num) - subset(esta, year==yr, e_prev_num)) / subset(esta, year==2000, e_prev_num) * 100, 2)
a2 <- tb %>% filter(year==yr, g_whoregion=="WPR") %>% summarize(cases=sum0(c_notified / 1e6)) %>% signif(2)
a3 <- tb %>% filter(year==yr-1, g_whoregion=="WPR", c_newrel_tsr >= 85) %>% nrow()

```

Tuberculosis (TB) control in the World Health Organization (WHO) Western Pacific Region has seen substantial progress in the last decade with a `r a1` reduction in prevalent TB cases since 2000. The burden remains immense however, and national TB programmes must evolve and adapt to build upon these gains. Through routine surveillance, countries and areas in the Region reported `r a2` million TB cases in `r yr`. The case notification rate increased in the early 2000s, appears to have stabilized in recent years and is in decline for all forms and laboratory-confirmed cases. The age and sex breakdown for laboratory-confirmed TB case rates by country shows generally higher rates with increased age and declining rates over time for all age groups. Treatment success remains high in the Region with `r a3` countries reaching or maintaining an 85% success rate. HIV testing among TB patients has increased gradually along with a slow decline in the number of HIV-positive patients found.

The trend of TB notification is heavily influenced by programmatic improvements in many countries and rapidly changing demographics. It appears that cases are being found earlier as reflected in declining rates of laboratory-confirmed TB with steady rates of TB in all forms. WHO estimates depict a decline in TB incidence in the Region. HIV testing, while still low, has increased substantially in recent years with essential TB/HIV services expanding in many countries.

TB surveillance data, within inherent limitations, is an important source of programmatic and epidemiological information. Careful interpretation of these findings can provide useful insight for programmatic decision-making.

--------------------------------------------------------

Introduction
--------------------------------------------------------
```{r intro, echo=FALSE}
i1 <- signif(subset(esta, year==2000, e_prev_num) / 1e6, 2)
i2 <- signif(subset(esta, year==yr, e_prev_num) / 1e6, 2)
i2a <- signif(sum0(subset(tb, g_whoregion=="WPR" & year >= 2000, c_newinc)) / 1e6, 3)
i3 <- tb %>% filter(year==yr, g_whoregion=="WPR") %>% summarize(cases=sum0(c_notified / 1e6)) %>% signif(2)
```

Significant progress has been made in tuberculosis (TB) control in the World Health Organization (WHO) Western Pacific Region especially in since 2000. The number of prevalent TB patients in the Region fell from `r i1` million in 2000 to `r i2` million in `r yr`.[@WorldHealthOrganization2014] During the same period, `r i2a` million patients were diagnosed and treated, and an estimated 800 000 deaths were averted between 2000 and 2010.[@WorldHealthOrganization2011] According to the latest WHO estimates, the Region is on track for achieving the TB-related Millennium Development Goals (MDGs) and other international targets by 2015. However, with `r i3` million TB patients notified annually in the Region and several countries with a persistent substantial disease burden, TB control policies and strategies require continuous evolution to adopt new tools and approaches as well as to address emerging challenges faced by national TB control programmes. In light of the MDG target date approaching, WHO has developed a new Global TB Strategy for after 2015.[@WorldHealthOrganization2014a] Particularly at this critical period of strategy renewal, thorough analysis of surveillance data provides valuable information on the current epidemiological situation, programmatic progress and future directions.

This article represents our second regional analysis of TB notification data as an article in the Western Pacific Surveillance and Response Journal. We plan to continue reporting an annual regional analysis in this way punctuated by complementary reports focused on various topics such as subnational data analysis and utilization, the situation of drug-resistant TB, contact investigation and other forms of TB screening activities to stimulate the utilization of surveillance data for informed programme decision-making.

Methods
--------------------------------------------------------
```{r methods, echo=FALSE}
m1 <- tb %>% filter(year==yr-1, g_whoregion=="WPR", !is.na(c_newinc)) %>% nrow()
m2 <- floor(tb %>% filter(year==yr-1, g_whoregion=="WPR", !is.na(c_newinc)) %>% summarize(pop=sum(e_pop_num)) / tb %>% filter(year==yr-1, g_whoregion=="WPR") %>% summarize(pop=sum(e_pop_num)) * 100 / 0.1) * 0.1 # rounding to increment

info <- sessionInfo()
r_ver <- paste(info$R.version$major, info$R.version$minor, sep=".")
```

### Data
Every year, 36 countries and areas in the Region are requested to report TB surveillance data to WHO using a standardized data collection form. Since 2009, a web-based online system has been used for data submission and validation. Collected data covers the following areas: TB case notifications and treatment outcomes, diagnostic and treatment services, drug management, surveillance and surveys of drug-resistance, information on TB/HIV co-infection, infection control, engagement of all care providers and budgets and expenditures for TB control. The full description of methods is available in the Global Tuberculosis Report 2014[@WorldHealthOrganization2014] and the data sets are available from the WHO global TB database (www.who.int/tb/data). Case definitions for TB can be found in the 4th edition of the TB treatment guidelines.[@WorldHealthOrganization2006] For `r yr`, `r m1` countries and areas of the Western Pacific Region reported data representing more than `r m2`% of the total population. This report describes the epidemiological situation and progress in programmatic response with a focus on seven countries with a high burden of TB: Cambodia, China, the Lao People's Democratic Republic, Mongolia, Papua New Guinea, the Philippines and Viet Nam. The remaining countries in the Region have been split into 20 Pacific Island countries and areas ("Pacific") and 9 other countries and areas ("Other").

### Analysis and reproducibility
Analysis was conducted by the statistical package R (ver. `r r_ver`, R Core Team, `r info$R.version$year`, Vienna, Austria, www.R-project.org). Due to calls for transparent and reproducible research,[@Peng2006; @Groves2012] we have published programme code to generate the entire contents of this article including all figures and tables by using R with the knitr package (ver. `r info$otherPkgs$knitr$Version`, Yihui Xie, `r format.Date(info$otherPkgs$knitr$Date, "%Y")`). Readers can download the code (see supplement material) and reproduce all figures and tables under an appropriate personal computing environment. For non-commercial purposes, readers may modify the code to produce figures and tables that are not presented in this article. For instance, readers may wish to produce tables and figures for countries or regions other than the WHO Western Pacific Region.

# Questions this analysis is trying to answer
How much TB still exists in WPR?
Is the amount of TB going up, coming down, or staying stable?
Where is TB clustering in the region?
Is the clustering staying the same or changing, if changing how?
where is the amount of TB coming down and at what rate? Is it going up anywhere?
Are child cases being found? What about among women? How is the disease progressing with aging countries?
What do we know about these populations and how is TB reflecting or being affected?
Where is TB still spreading and where is it only reactivation? Where are chunks of the population likely not infected?
What is the relationship between wealth (GDP) and TB motality at the national level? What are the macro associations (causes) for TB?
What is the relationship between Migrant stock and TB?
Which programmes are ahead of the game in finding cases?
Which programmes treat the best? If you get TB, which country do you hope you live in?

Structure
table of latest year
map of latest year
trend by group

HIGH BURDEN
relationship between GDP and mort
aging plot
notif trend panel plot
treatment success
financing?
HIV?

PACIFIC
scatter of notif rate by abs num 
MDR in the pacific

OTHER
scatter of rate and abs num
scatter of rate and migrant stock, maybe include foreign born var
aging plot


Results
--------------------------------------------------------


### Case notification

```{r t-notif-data, warning=FALSE}
tableCount <- incCount(tableCount, "t-notif")

# Notification table

tbb <- subset(tb, year==yr & g_whoregion=="WPR", select=c('country', 'g_whoregion', 'g_hbc22', 'c_notified', 'c_newinc', "new_labconf", "new_clindx", "new_ep", "ret_rel_labconf", "ret_rel_clindx", "ret_rel_ep", "ret_nrel"))

tbb <- tbb[order(tbb$country),]
names(tbb)[names(tbb)=='country'] <- 'area'

# make aggregate rows
tbbr <- aggregate(tbb[4:ncol(tbb)], by=list(area=tbb$g_whoregion), FUN=sum, na.rm=TRUE)

# combine together
tbc <- rbind(tbb[c(1, 4:ncol(tbb))], tbbr) # tbbh, , tbbga

# calculate and format vars

tbc$nrpulm_lab_pct <- .rowsums(tbc[c("new_labconf", "ret_rel_labconf")] )* 100 / .rowsums(tbc[c("new_labconf", "new_clindx", "ret_rel_labconf", "ret_rel_clindx")])

for(var in 2:ncol(tbc)){
  tbc[var] <- rounder(tbc[[var]])
  }

tbc[is.na(tbc$nrpulm_lab_pct), 'nrpulm_lab_pct'] <- "\u2013"

# rename
tbc <- .WPSARnames(tbc, col='area')

# Add to file

tbm <- xtable(tbc[c("area", "c_notified", 'c_newinc', "ret_nrel", "new_labconf", "new_clindx", "new_ep", "ret_rel_labconf", "ret_rel_clindx", "ret_rel_ep", "nrpulm_lab_pct")])

digits(tbm) <- 0

write.csv(tbm, file=paste0(pasteLabel("./figure_data/table", tableCount, "t-notif", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE, na="")

# for paragraph
n1 <- paste(signif(tbbr$c_notified / 1e6, 2), "million")
n2 <- signif(tbbr$c_notified / sum(subset(tb, year==yr, c_notified), na.rm=TRUE) * 100, 2)
n3 <- signif(tbbr$c_newinc / tbbr$c_notified * 100, 3)
n4 <- tbc[nrow(tbc),"c_newinc"]
n5 <- signif(tbb[tbb$area == "China","c_notified"] / tbbr$c_notified * 100, 2)
n6 <- tbc[tbc$area == "China","c_notified"]
n7 <- signif(tbb[tbb$area == "Philippines","c_notified"] / tbbr$c_notified * 100, 2)
n8 <- tbc[tbc$area == "Philippines","c_notified"]
n9 <- signif(tbb[tbb$area == "Viet Nam","c_notified"] / tbbr$c_notified * 100, 2)
n10 <- tbc[tbc$area == "Viet Nam","c_notified"]

```

```{r m-notif-data, include=FALSE}

figCount <- incCount(figCount, "m-notif")

mc <- subset(tb, year==yr & g_whoregion=="WPR", select=c(country, iso2, iso3, g_whoregion, c_newinc, e_pop_num))

mc$c_newinc_100k <- mc$c_newinc / mc$e_pop_num *1e5

mc$cat <- cut(round(mc$c_newinc_100k,0), c(0, 10, 50, 100, 200, Inf), c('0–9', '10–49', '50–99', '100–199', '>199'), right=FALSE)

mc1 <- WHOmap.print(mc, legend.title= "TB cases per \n100 000 population", copyright=FALSE, show=FALSE, zoom="WPR")

write.csv(mc, file=paste0(pasteLabel("./figure_data/figure", figCount, "m-notif", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)

# for paragraph
n11 <- mc %>% filter(cat==">199") %>% arrange(desc(c_newinc_100k)) %>% .WPSARnames(the=TRUE) %>% mutate(c=country, r=signif(c_newinc_100k,3)) %>% select(c,r) 
n12 <- paste(paste(n11[1:(nrow(n11)-1),"c"], collapse=", "), n11[nrow(n11),"c"], sep=" and ")
n13 <- paste(paste(n11[1:(nrow(n11)-1),"r"], collapse=", "), n11[nrow(n11),"r"], sep=" and ")

```


In `r yr`, countries and areas in the Region reported `r n1` people with TB disease (`r I(pasteLabel("Table", tableCount, "t-notif"))`). This accounts for `r n2`% of the global burden. Of these cases, `r n3`% (`r n4`) were new episodes of TB disease (either new or relapse cases). Within the Region China accounts for `r n5`% (`r n6`) of the caseload with the Philippines and Viet Nam following with `r n7`% (`r n8`) and `r n9`% (`r n10`), respectively. TB notification rates, expressed as cases per 100 000 population, vary substantially in the Region with the highest rates found in `r n12`  with `r n13` per 100 000 population, respectively (`r I(pasteLabel("Table", tableCount, "t-notif"))`, `r I(pasteLabel("Figure", figCount, "m-notif"))`). 

--------------------------------------------------------

<a id="t-notif"></a> 
**`r I(pasteLabel("Table", tableCount, "t-notif", insLink=FALSE))`. Tuberculosis case notification from countries and areas of the Western Pacific Region, `r yr`**  
```{r t-notif, results='asis'}

print(tbm, type="html", include.rownames=F, include.colnames=F, html.table.attributes="border=0 rules=rows width=900 cellpadding=5", add.to.row=list(pos=list(0, nrow(tbm)), command=c(
  "<TR> 
  <TD colspan='4' style='border-right: solid 2px black;'></TD> 
  <TH colspan='3' style='border-right: solid 2px black;'>NEW OR PREVIOUS TREATMENT HISTORY UNKNOWN</TH> 
  <TH colspan='3' style='border-right: solid 2px black;'>RELAPSE</TH> 
  <TD></TD> 
  </TR> 
  <TR> 
  <TD></TD> 
  <TD>TOTAL NOTIFIED</TD> 
  <TD>NEW AND RELAPSE <sup>a</sup></TD> 
  <TD style='border-right: solid 2px black;'>RETREATMENT EXCLUDING RELAPSE</TD> 
  <TD>PULMONARY BACTERIOLOGICALLY CONFIRMED</TD>
  <TD>PULMONARY CLINICALLY DIAGNOSED</TD> 
  <TD style='border-right: solid 2px black;'>EXTRAPULMONARY</TD> 
  <TD>PULMONARY BACTERIOLOGICALLY CONFIRMED</TD>
  <TD>PULMONARY CLINICALLY DIAGNOSED</TD> 
  <TD style='border-right: solid 2px black;'>EXTRAPULMONARY</TD> 
  <TD>PERCENTAGE OF PULMONARY CASES BACTERIOLOGICALLY CONFIRMED</TD> 
  </TR> 
  <TR>", 
  "<TR> <TD colspan=11>Blank cells indicate data not reported.<br>
  <sup>a</sup> NEW AND RELAPSE includes cases for which the treatment history is unknown.</TD></TR>")))

```  


--------------------------------------------------------

<a id="m-notif"></a> 
**`r I(pasteLabel("Figure", figCount, "m-notif", insLink=FALSE))` Tuberculosis case notification rate (new and relapse) per 100 000 population in countries and areas of the Western Pacific Region, `r yr`**  
```{r m-notif, fig.height=5}

mc1
```  

<font size="1">The boundaries shown and the designations used on this map do not imply the expression of any opinion whatsoever on the part of the World Health Organization concerning the legal status of any country, territory, city or area or of its authorities, or concerning the delimitation of its frontiers or boundaries. White lines on maps represent approximate border lines for which there may not yet be full agreement.</font>

--------------------------------------------------------

```{r f-notif-trend-data}

figCount <- incCount(figCount, "f-notif-trend")

nota <- tb  %>% 
  filter(year >= 2000 & g_whoregion=="WPR") %>% 
  group_by(year) %>%
  summarize(g_wpr="WPR", "All forms of TB" = sum0(c_newinc) / sum0(e_pop_num) * 1e5, 
            "New smear-positive" = sum0(new_sp) / sum0(e_pop_num) * 1e5,
            "New lab-confirmed" = sum0(ifelse(year < 2013, NA, new_labconf)) / sum0(e_pop_num) * 1e5) %>%
  as.data.frame() %>%
  gather(variable, value, 3:4)

notb <- tb  %>% 
  filter(year >= 2000 & g_whoregion=="WPR") %>% 
  group_by(g_wpr, year) %>%
  summarize("All forms of TB" = sum0(c_newinc) / sum0(e_pop_num) * 1e5, 
            "New smear-positive" = sum0(new_sp) / sum0(e_pop_num) * 1e5,
            "New lab-confirmed" = sum0(ifelse(year < 2013, NA, new_labconf)) / sum0(e_pop_num) * 1e5) %>%
#             "New lab-confirmed" = sum0(ifelse(year < 2013, new_sp, new_labconf)) / sum0(e_pop_num) * 1e5) %>%
  as.data.frame() %>%
  gather(variable, value, 3:4)

notc <- rbind(nota, notb)
notc$g_wpr <- factor(notc$g_wpr, levels=c("High-burden", "Pacific", "Other", "WPR"))

write.csv(notc, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-notif-trend", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)


# for paragraph
n20 <- notc %>% filter(g_wpr=="High-burden", variable=="All forms of TB") %>% summarize(round(max(value)))
n21 <- notc %>% filter(g_wpr=="Pacific", variable=="All forms of TB") %>% summarize(min=round(min(value)), max=round(max(value)))
n22 <- notc %>% filter(g_wpr=="Pacific", variable=="New smear-positive") %>% summarize(min=round(min(value)), max=round(max(value)))
n23 <- notc %>% filter(g_wpr=="Other", variable=="All forms of TB", year==yr) %>% select(value)  %>% round() 
  

```

Case notification rates in high-burden countries increased dramatically for six years starting in 2002 peaking at `r n20` cases per 100 000 population. A smaller increase in rate of all forms of TB occurred between 2010 and 2012 (`r I(pasteLabel("Figure", figCount, "f-notif-trend"))`). The overall trend for the Region follows that of the high-burden countries. TB in the Pacific fluctuated between `r n21$min` and `r n21$max` for all forms of TB and `r n22$min` and `r n22$max` for smear-positive cases with no distinct trend. Other countries in the Region have held more steady rates with the rate of all forms at `r n23`.


--------------------------------------------------------

<a id="f-notif-trend"></a> 
**`r I(pasteLabel("Figure", figCount, "f-notif-trend", insLink=FALSE))` Tuberculosis case notification rate (all forms and new laboratory-confirmed) per 100 000 population in the Western Pacific Region, 2000--`r yr`**  
```{r f-notif-trend, fig.height=5, warning=FALSE}

ggplot(notc, aes(year, value, color=variable, ymin=0)) + geom_line(size=1) + geom_point(aes(year, `New lab-confirmed`, shape="New lab-confirmed")) + facet_wrap(~g_wpr, nrow=1) + theme_report() + scale_x_continuous("", breaks = pretty_breaks()) + scale_y_continuous("TB cases per 100 000 per year", breaks = pretty_breaks()) + theme(legend.position="bottom") + scale_color_brewer("", type="qual", palette=6) + scale_shape(" ")



```

--------------------------------------------------------

### High-burden countries

```{r f-gdp-hb-data, include=FALSE}

figCount <- incCount(figCount, "f-gdp-hb")

# Get GDP from world bank data
require(WDI)

gb <- WDI(indicator='NY.GDP.PCAP.KD', start=2000, end=2013, extra=FALSE)

gc <- merge(tb, gb, by.x = c("iso2", "year"), by.y=c("iso2c", "year"))

ga <- gc %>%
  filter(g_wpr=="High-burden") %>% 
  select(iso3, year, gdp=NY.GDP.PCAP.KD, mort=e_mort_exc_tbhiv_100k, mort.lo=e_mort_exc_tbhiv_100k_lo, mort.hi=e_mort_exc_tbhiv_100k_hi)


write.csv(ga, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-gdp-hb", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)


# for paragraph
h1 <- tb %>% filter(year==yr, g_whoregion=="WPR") %>% group_by(g_wpr) %>% summarize(prev=sum0(e_prev_num))
h2 <- round(h1[1,2] / h1 %>% summarize(prev=sum(prev)) * 100)
  
  

```


The seven high-burden countries of the Region account for `r h2`% of the estimated caseload. All seven countries have experienced a decrease in TB mortality since 2000 as well as an overall increasing trend in gross domestic product (GDP) (`r I(pasteLabel("Figure", figCount, "f-gdp-hb"))`).

--------------------------------------------------------

<a id="f-gdp-hb"></a> 
**`r I(pasteLabel("Figure", figCount, "f-gdp-hb", insLink=FALSE))` TB mortality^a^ per 100 000 population compared with gross domestic product (GDP) per capita in seven high-burden countries of the Western Pacific Region, 2000--`r yr`**  
```{r f-gdp-hb, fig.height=5}

ggplot(ga, aes(gdp, mort, color=iso3)) + geom_path(size=1, arrow=arrow(length=unit(0.3, "cm"))) + theme_report() + scale_x_log10("GDP per capita (constant 2000 US$)", limits=c(300, 4000), breaks=c(300, 1e3, 2e3, 3e3, 4e3)) + scale_y_log10("Estimated TB mortality per 100 000 per year", limits=c(1, 200), breaks=c(1, 10, 50, 100, 200)) + scale_color_brewer("", type="qual", palette=6) + geom_text(data=subset(ga, year==yr), aes(label=iso3), hjust=1, vjust=1.5) + theme(legend.position="none")

# ggplot(ga, aes(gdp, mort, color=iso3)) + geom_ribbon(aes(gdp, ymin=mort.lo, ymax=mort.hi), alpha=0.4) + geom_path(size=1) + theme_report() + scale_x_log10("GDP per capita (constant 2000 US$)", limits=c(300, 4000), breaks=c(300, 1e3, 2e3, 3e3, 4e3)) + scale_y_log10("Estimated TB mortality per 100 000 per year", limits=c(1, 200), breaks=c(1, 10, 50, 100, 200)) + scale_color_brewer("", type="qual", palette=6) + geom_text(data=subset(ga, year==yr), aes(label=iso3), hjust=1, vjust=1.5) + theme(legend.position="none")


```

^a^ TB mortality excludes deaths due to HIV in accordance with ICD-10.




--------------------------------------------------------

### Distribution by age and sex


```{r agesex-data,  echo=FALSE}
figCount <- incCount(figCount, "f-agesex-bar")
figCount <- incCount(figCount, "f-agesex")

aga <- merge(subset(tb, year > 1999, select=c("iso3", "country", "year", "g_whoregion", "g_hbc22", "newrel_m04", "newrel_m514", "newrel_m014", "newrel_m1524", "newrel_m2534", "newrel_m3544", "newrel_m4554", "newrel_m5564", "newrel_m65", "newrel_mu", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f1524",  "newrel_f2534", "newrel_f3544", "newrel_f4554", "newrel_f5564", "newrel_f65", "newrel_fu",
                                              "new_sp_m04", "new_sp_m514", "new_sp_m014", "new_sp_m1524", "new_sp_m2534", "new_sp_m3544", "new_sp_m4554", "new_sp_m5564", "new_sp_m65", "new_sp_mu", "new_sp_f04", "new_sp_f514", "new_sp_f014", "new_sp_f1524",  "new_sp_f2534", "new_sp_f3544", "new_sp_f4554", "new_sp_f5564", "new_sp_f65", "new_sp_fu",
                                              "new_sn_m04", "new_sn_m514", "new_sn_m014", "new_sn_m1524", "new_sn_m2534", "new_sn_m3544", "new_sn_m4554", "new_sn_m5564", "new_sn_m65", "new_sn_mu", "new_sn_f04", "new_sn_f514", "new_sn_f014", "new_sn_f1524",  "new_sn_f2534", "new_sn_f3544", "new_sn_f4554", "new_sn_f5564", "new_sn_f65", "new_sn_fu", 
                                              "new_ep_m04", "new_ep_m514", "new_ep_m014", "new_ep_m1524", "new_ep_m2534", "new_ep_m3544", "new_ep_m4554", "new_ep_m5564", "new_ep_m65", "new_ep_mu", "new_ep_f04", "new_ep_f514", "new_ep_f014", "new_ep_f1524",  "new_ep_f2534", "new_ep_f3544", "new_ep_f4554", "new_ep_f5564", "new_ep_f65", "new_ep_fu")), subset(p, year>1999, select=c("iso3", "country", "year", "e_pop_m04", "e_pop_m514", "e_pop_m014", "e_pop_m1524", "e_pop_m2534", "e_pop_m3544", "e_pop_m4554", "e_pop_m5564", "e_pop_m65", "e_pop_f04", "e_pop_f514", "e_pop_f014", "e_pop_f1524", "e_pop_f2534", "e_pop_f3544", "e_pop_f4554", "e_pop_f5564", "e_pop_f65")))

# Aggregate for region
agb1 <- aggregate(aga[6:ncol(aga)], by=list(year=aga$year, area=aga$g_whoregion), FUN=sum, na.rm=TRUE)

agb1[c('iso3', 'g_hbc22')] <- NA
agb1$iso3 <- agb1$area
agb1$g_whoregion <- agb1$area
aga1 <- reshape::rename(aga,c('country'='area'))
agb <- rbind(aga1, agb1)

# Calculate rates

agc <- melt(agb, id=1:5)
# agc[c('new', 'type', 'group')] <- str_split_fixed(agc$variable, '_', n=3) # This takes me 25 seconds...it's the '_all' or '_fixed' that's the killer.
agc$type1 <- str_extract(agc$variable, 'newrel|pop|new_sp|new_sn|new_ep')
agc$age <- str_replace(agc$variable, "newrel_|e_pop_|new_sp_|new_sn_|new_ep_", "")
agc$sex <- str_replace(agc$age, '[u]|[0-9]+', "")
agc$age <- str_replace(agc$age, '[f]|[m]', "")

# aggregate all types for previous years
agc$type <- ifelse(agc$type1=="pop", "pop", "newrel")
agc$value <- as.numeric(agc$value) # avoid integer overflow
agd1 <- agc %>%
  group_by(iso3, area, year, g_whoregion, g_hbc22, type, age, sex) %>%
  summarise(value=sum0(value)) # %>%
agd <- cast(agd1, ...~type, value = "value")

agd$newrel_100k <- agd$newrel / agd$pop * 1e5

# Subset for WPRO
age <- subset(agd, (iso3 %in% whbc | area=="WPR") & age!="u" & !age %in% c("04", "514"))
age$sex <- factor(age$sex, levels=c("m", "f"), labels=c("Male", "Female"))
age$sh.name <- factor(age$iso3, c("KHM", "CHN", "LAO", "MNG", "PNG", "PHL", "VNM", "WPR"), c("Cambodia", "China", "Lao People’s \nDemocratic Republic", "Mongolia", "Papua New Guinea", "Philippines", "Viet Nam", "WPR"))
age[is.na(age$sh.name), 'sh.name'] <- "WPR"
age$age <- factor(age$age, c("014", "1524", "2534", "3544", "4554", "5564", "65"), c("0–14", "15–24", "25–34", "35–44", "45–54", "55–64", "\u2265 <65"))

write.csv(age, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-agesex-bar", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)

write.csv(age, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-agesex", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)
```

`r I(pasteLabel("Figure", figCount, "f-agesex-bar"))` shows age group and sex-specific case notification rates of new laboratory-confirmed cases for the countries with a high burden of TB in the Region with available data (note that the scale of the vertical axis is different for each country). Many countries follow a typical pattern for cross-sectional observations with increasing notification rates towards older populations except in Mongolia. In general, males are more affected than females with male-to-female TB ratios as high as three as seen in Viet Nam.

--------------------------------------------------------

<a id="f-agesex-bar"></a> 
**`r I(pasteLabel("Figure", figCount, "f-agesex-bar", insLink=FALSE))` Age group- and sex-specific notification rates (per 100 000 population) of new and relapse TB cases in countries with a high-burden of TB in the Western Pacific Region, `r yr`**  
``` {r f-agesex-bar, fig.height=11, warning=FALSE}

# Workaround for non-reporting countries (so it doesn't break the plot)

age2 <- subset(age, year==yr)
age2$newrel_100k <- ifelse(is.na(age2$newrel_100k), 0, age2$newrel_100k)
agereport <- age2 %>% group_by(sh.name) %>% summarise(var=sum(newrel_100k)) %>% filter(var>0) %>% select(sh.name)
age3 <- subset(age2, sh.name %in% agereport$sh.name)

p2 <- ggplot(age3, aes(age, newrel_100k, fill=sex)) + geom_bar(stat="identity", position="dodge") + facet_wrap(~sh.name, scales="free_y", ncol=2)   + theme_report() + scale_fill_brewer('Sex', type="qual", palette=6) + scale_x_discrete("Age group", labels=c("0–14", "15–24", "25–34", "35–44", "45–54", "55–64", "\u2265 65")) + theme(legend.position="bottom")

p2 + scale_y_continuous("New and relapse cases per 100 000")


```

--------------------------------------------------------

`r I(pasteLabel("Figure", figCount, "f-agesex"))` shows trends of notification rates of new laboratory-confirmed cases of age- and sex-specific groups in the seven countries with a high-burden of TB from 2000–`r yr`. Some countries demonstrated a declining trend of case notification for almost all age- and sex- groups, such as Cambodia, China and Viet Nam while others showed a less apparent trend except Papua New Guinea with a sharply increasing trend.

--------------------------------------------------------

<a id="f-agesex"></a> 
**`r I(pasteLabel("Figure", figCount, "f-agesex", insLink=FALSE))` Trend of age group- and sex-specific notification rates (per 100 000 population) of new and relapse^a^ tuberculosis cases in seven countries with a high-burden of TB in the Western Pacific Region, 2000--`r yr`**  
``` {r f-agesex, warning=FALSE, fig.height=15}

p1 <- ggplot(age, aes(year, newrel_100k, color=age)) + geom_line() + facet_grid(sh.name~sex, scales='free_y') + theme_report() + scale_x_continuous("", breaks = pretty_breaks()) + scale_color_brewer("Age group", type="seq", palette=4)

p1 + scale_y_continuous("New and relapse cases per 100 000")
# p1 + scale_y_log10("New laboratory-confirmed cases per 100 000")                                                                                                                                                        
#function (x) floor(x)); function(n) n[floor(length(n)/5)*1:5+1]
```

^a^ Rates prior to 2013 include new cases only.

--------------------------------------------------------

### Treatment outcomes

```{r f-txout-bar-data}

figCount <- incCount(figCount, "f-txout-bar")

tra <- subset(tb, year %in% 2000:(yr-1) & g_whoregion=="WPR", select=c(year, new_sp_coh, new_sp_cur, new_sp_cmplt, new_sp_died, new_sp_fail, new_sp_def, newrel_coh, newrel_succ, newrel_died, newrel_fail, newrel_lost))

trb <- aggregate(tra[2:ncol(tra)], by=list(year=tra$year), FUN=sum, na.rm=TRUE)

trb$Success <- (trb$new_sp_cur + trb$new_sp_cmplt + trb$newrel_succ) / (trb$new_sp_coh + trb$newrel_coh) * 100
trb$Died <- (trb$new_sp_died + trb$newrel_died) / (trb$new_sp_coh + trb$newrel_coh) * 100
trb$Failed <- (trb$new_sp_fail + trb$newrel_fail) / (trb$new_sp_coh + trb$newrel_coh) * 100
trb$Defaulted <- (trb$new_sp_def + trb$newrel_lost) / (trb$new_sp_coh + trb$newrel_coh) * 100
trb$`Not evaluated` <- ((trb$new_sp_coh + trb$newrel_coh) - (trb$new_sp_cur + trb$new_sp_cmplt + trb$new_sp_died + trb$new_sp_fail + trb$new_sp_def)) / (trb$new_sp_coh + trb$newrel_coh) * 100

trc <- melt(trb[c("year", "Success", "Died", "Failed", "Defaulted", "Not evaluated")], id=1)

write.csv(trc, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-txout-bar", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)

# for paragraph 

# This can be replaced when the new data file is here (~2015)
tb2 <- tb
if(is.null(head(tb2$c_tsr))) tb2$c_tsr <- NA

n30 <- tb2 %>% filter(year==yr-1, g_whoregion=="WPR") %>% .WPSARnames(the=TRUE) %>% mutate(tsr=ifelse(!is.na(c_tsr), c_tsr, ifelse(!is.na(c_newrel_tsr), c_newrel_tsr, c_new_tsr))) %>% arrange(desc(tsr)) %>% select(country, iso3, tsr, newrel_coh, newrel_succ, newrel_fail, newrel_died, newrel_lost) %>% filter(tsr>0)
n31 <- n30 %>% filter(tsr >=85) %>% nrow()
n32 <- n30 %>% filter(iso3 %in% whbc) %>% mutate(tsr=signif(tsr,2))
n33 <- n32 %>% filter(tsr==last(tsr)) %>% mutate(neval=newrel_coh - sum(newrel_succ, newrel_fail, newrel_died, newrel_lost), l=signif(sum(newrel_lost, neval) / newrel_coh * 100, 2)) %>% select(l) %>% mutate(l=ifelse(l %in% 22:25, "approximately a quarter", ifelse(l %in% 25:29, "over a quarter", paste0(l, "%"))))

```

The Region continued observing treatment success rates beyond the target of 85% (`r I(pasteLabel("Figure", figCount, "f-txout-bar"))`), and the rate has been at 85% or higher over the past several years. Across the Region, `r n31` countries and areas reached or maintained the 85% treatment success target. Among the countries with a high burden of TB, the treatment success rate was highest in `r n32[1,1]` (`r n32[1,3]`%) followed by `r n32[2,1]` (`r n32[2,3]`%), `r n32[3,1]` (`r n32[3,3]`%), `r n32[4,1]` (`r n32[4,3]`%), `r n32[5,1]` (`r n32[5,3]`%) and `r n32[6,1]` (`r n32[6,3]`%). The treatment success rate of `r n32[7,1]` was the lowest at `r n32[7,3]`% with `r n33` of the `r yr-1` cohort either lost to follow-up or un-evaluated.

--------------------------------------------------------

<a id="f-txout-bar"></a> 
**`r I(pasteLabel("Figure", figCount, "f-txout-bar", insLink=FALSE))` Trend of treatment outcome expressed as a proportion among new laboratory-confirmed cases in the Western Pacific Region, 2000--`r yr-1`**  
``` {r f-txout-bar, fig.width=9}

ggplot(trc, aes(year, value, fill=variable)) + geom_bar(stat="identity", position="stack") + theme_report() + scale_fill_brewer('Outcome', type="qual", palette=6) + scale_x_continuous("", breaks=min(trc$year):max(trc$year)) + scale_y_continuous("Percent of cohort") + coord_cartesian(ylim=c(60,100)) + guides(fill = guide_legend(reverse = TRUE))



```

--------------------------------------------------------

### TB/HIV co-infection and collaborative activities

```{r f-tbhiv-data}

figCount <- incCount(figCount, "f-tbhiv")

tha1 <- subset(tb, year >= 2005 & g_whoregion=="WPR" & iso3 %in% whbc, select=c("country", "year", "iso3", "g_hbc22", "c_notified", "hivtest", "hivtest_pos", "hiv_cpt", "hiv_art", "hivtest_pct_numerator", "hivtest_pct_denominator", "hivtest_pos_pct_numerator", "hivtest_pos_pct_denominator", "hiv_cpt_pct_numerator", "hiv_cpt_pct_denominator", "hiv_art_pct_numerator", "hiv_art_pct_denominator"))

tha2 <- aggregate(tha1[5:ncol(tha1)], by=list(year=tha1$year), FUN=sum, na.rm=TRUE)
tha2[c("country", "iso3")] <- "WPR"
tha2[c("g_hbc22")] <- NA
tha <- rbind(tha1, tha2)

tha$test <- tha$hivtest_pct_numerator / tha$hivtest_pct_denominator * 100
tha$pos <- tha$hivtest_pos_pct_numerator / tha$hivtest_pos_pct_denominator * 100
tha$cpt <- tha$hiv_cpt_pct_numerator / tha$hiv_cpt_pct_denominator * 100
tha$art <- tha$hiv_art_pct_numerator / tha$hiv_art_pct_denominator * 100

thb <- melt(tha[c("iso3", "year", "test", "pos", "cpt", "art")], id=1:2)

thb$variable <- factor(thb$variable, levels=c("test", "pos", "cpt", "art"), labels=c("HIV testing \namong TB patients", "HIV-positive among \nTB patients tested", "CPT coverage \namong co-infected", "ART coverage \namong co-infected"))

thb$country <- factor(thb$iso3, c("KHM", "CHN", "LAO", "MNG", "PNG", "PHL", "VNM", "WPR"), c("Cambodia", "China", "Lao \nPeople’s \nDemocratic \nRepublic", "Mongolia", "Papua \nNew \nGuinea", "Philippines", "Viet Nam", "Western \nPacific \nRegion"))

write.csv(thb, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-tbhiv", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)
```

There has been some progress in reporting of information on TB/HIV co-infection and collaborative activities in the last several years. `r I(pasteLabel("Figure", figCount, "f-tbhiv"))` summarizes four basic indicators (HIV testing, HIV positivity rate, co-trimoxazole preventive therapy (CPT) coverage and  antiretroviral 
therapy (ART) coverage) for the seven countries with a high burden of TB. Cambodia reported the most comprehensive data completeness and programmatic progress. The coverage of HIV testing, CPT and ART progressively increased with a steady decrease in the proportion of HIV positive individuals among TB patients.

--------------------------------------------------------

<a id="f-tbhiv"></a> 
**`r I(pasteLabel("Figure", figCount, "f-tbhiv", insLink=FALSE))` Progress in TB/HIV activities in seven countries in the Western Pacific Region with a high burden of TB, 2005--`r yr`**  
``` {r f-tbhiv, fig.width=7, fig.height=9, warning=FALSE}

ggplot(thb, aes(year, value)) + geom_line(size=1) + facet_grid(country~variable) + theme_report() + labs(y="Percent", x="")

```

--------------------------------------------------------

### Pacific Island Countries


```{r f-notif-pac-data, echo=FALSE}

figCount <- incCount(figCount, "f-notif-pac")

pa <- tb %>%
  filter(g_wpr=="Pacific", year==yr) %>% 
  mutate(c_newinc_100k=c_newinc / e_pop_num * 1e5) %>%
  select(country, iso3, c_newinc, c_newinc_100k)

pb <- pa %>%
  filter(c_newinc==0) %>%
  arrange(country) %>%
  select(country)

pc <- pa %>%
  filter(is.na(c_newinc)) %>%
  arrange(country) %>%
  select(country)

pd <- pa %>%
  filter(!is.na(c_newinc), c_newinc!=0) 
  
write.csv(pa, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-notif-pac", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)


# for paragraph
p1 <- lister(pb$country)
p2 <- lister(pc$country)
  
  

```


The seven high-burden countries of the Region account for `r h2`% of the estimated caseload. All seven countries have experienced a decrease in TB mortality since 2000 as well as an overall increasing trend in gross domestic product (GDP) (`r I(pasteLabel("Figure", figCount, "f-gdp-hb"))`).

--------------------------------------------------------

<a id="f-notif-pac"></a> 
**`r I(pasteLabel("Figure", figCount, "f-notif-pac", insLink=FALSE))` New and relapse TB cases per 100 000 population compared with absolute number of cases in `r nrow(pd)` Pacific Island countries^a^ of the Western Pacific Region, `r yr`**  
```{r f-notif-pac, fig.height=5, fig.width=8, echo=FALSE, warning=FALSE}

# ggplot(pd, aes(c_newinc, c_newinc_100k)) + geom_text(aes(label=iso3)) + theme_report() + scale_x_log10("Total new and relapse cases", limits=c(1, 500), breaks=c(1, 10, 100, 200, 300, 400, 500)) + scale_y_log10("New and relapse cases per 100 000", limits=c(5, 400), breaks=c(5, 10, 50, 100, 200, 300, 400)) + theme(legend.position="none")

direct.label(ggplot(pd, aes(c_newinc, c_newinc_100k, color=iso3)) + geom_point() + theme_report() + scale_x_continuous("Total new and relapse cases") + scale_y_continuous("New and relapse cases per 100 000") )



```

^a^ `r p1` reported 0 TB cases and `r p2` did not report data for `r yr`. 

--------------------------------------------------------





--------------------------------------------------------


### Other countries

```{r f-notif-oth-data, echo=FALSE}

figCount <- incCount(figCount, "f-notif-oth")

oa <- tb %>%
  filter(g_whoregion=="WPR", g_wpr=="Other", year>=2000) %>% 
  mutate(c_newinc_100k=c_newinc / e_pop_num * 1e5) %>%
  select(country, year, iso3, c_newinc, c_newinc_100k)


write.csv(oa, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-notif-oth", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)


# for paragraph
  
  

```


The seven high-burden countries of the Region account for `r h2`% of the estimated caseload. All seven countries have experienced a decrease in TB mortality since 2000 as well as an overall increasing trend in gross domestic product (GDP) (`r I(pasteLabel("Figure", figCount, "f-gdp-hb"))`).

--------------------------------------------------------

<a id="f-notif-oth"></a> 
**`r I(pasteLabel("Figure", figCount, "f-notif-oth", insLink=FALSE))` New and relapse TB cases per 100 000 population compared with absolute number of cases in `r nrow(oa)` countries of the Western Pacific Region, 2000--`r yr`**  
```{r f-notif-oth, fig.height=5, fig.width=7, echo=FALSE}

# ggplot(pd, aes(c_newinc, c_newinc_100k)) + geom_text(aes(label=iso3)) + theme_report() + scale_x_log10("Total new and relapse cases", limits=c(1, 500), breaks=c(1, 10, 100, 200, 300, 400, 500)) + scale_y_log10("New and relapse cases per 100 000", limits=c(5, 400), breaks=c(5, 10, 50, 100, 200, 300, 400)) + theme(legend.position="none")

# direct.label(ggplot(oa, aes(c_newinc, c_newinc_100k, color=iso3)) + geom_point() + theme_report() + scale_x_continuous("Total new and relapse cases") + scale_y_continuous("New and relapse cases per 100 000") )

ggplot(oa, aes(c_newinc, c_newinc_100k, color=iso3)) + geom_path(size=1, arrow=arrow(angle = 30, length = unit(0.3, "cm"))) + theme_report() + scale_x_continuous("Total new and relapse cases") + scale_y_continuous("New and relapse cases per 100 000") + scale_color_brewer("", type="qual", palette=6) + geom_text(data=subset(oa, year==yr), aes(label=iso3), hjust=1, vjust=1.5) + theme(legend.position="none")

ggplot(subset(oa, year %in% c(2000, 2013)), aes(c_newinc, c_newinc_100k, color=iso3)) + geom_path(size=1) + theme_report() + scale_x_continuous("Total new and relapse cases") + scale_y_continuous("New and relapse cases per 100 000") + scale_color_brewer("", type="qual", palette=6) + geom_text(data=subset(oa, year==yr), aes(label=iso3), hjust=1, vjust=1.5) + theme(legend.position="none")

```

^a^ `r p1` reported 0 TB cases and `r p2` did not report data for `r yr`. 

--------------------------------------------------------

```{r f-migrant-other-data, include=FALSE}

figCount <- incCount(figCount, "f-migrant-other")

# Get GDP from world bank data
require(WDI)

oba <- WDI(indicator='SM.POP.TOTL.ZS', start=1990, end=2013, extra=FALSE)

obc <- merge(tb, oba, by.x = c("iso2", "year"), by.y=c("iso2c", "year"))

obb <- obc %>%
  filter(g_wpr=="Other", g_whoregion=="WPR") %>% 
  mutate(mig_pct=ifelse(year<2013, new_foreign, notif_foreign) / c_notified * 100) %>% # despite it's name "new_foreign" is among all notified cases.
  select(iso3, year, mig=SM.POP.TOTL.ZS, c_newinc_100k, mig_pct) 
obd <- obb %>%
  filter(!is.na(mig), !is.na(c_newinc_100k))

# obe <- obc %>%
#   filter(g_wpr=="Other", g_whoregion=="WPR") %>% 
#   summarize(mig_ave=sum0(new_foreign) / c_notified * 100) %>% # despite it's name "new_foreign" is among all notified cases.
#   select(iso3, year, mig=SM.POP.TOTL.ZS, c_newinc_100k, mig_pct) 



write.csv(obb, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-migrant-other", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)


# for paragraph
h1 <- tb %>% filter(year==yr, g_whoregion=="WPR") %>% group_by(g_wpr) %>% summarize(prev=sum0(e_prev_num))
h2 <- round(h1[1,2] / h1 %>% summarize(prev=sum(prev)) * 100)
  
  

```


The seven high-burden countries of the Region account for `r h2`% of the estimated caseload. All seven countries have experienced a decrease in TB mortality since 2000 as well as an overall increasing trend in gross domestic product (GDP) (`r I(pasteLabel("Figure", figCount, "f-migrant-other"))`).

--------------------------------------------------------

<a id="f-migrant-other"></a> 
**`r I(pasteLabel("Figure", figCount, "f-migrant-other", insLink=FALSE))` Foreign-born TB cases and international migrant stock in nine countries of the Western Pacific Region, 2007--`r yr`**  
```{r f-migrant-other, fig.height=5, warning=FALSE}

# ggplot(obd, aes(mig, c_newinc_100k, color=iso3)) + geom_path(size=1, arrow=arrow(length=unit(0.3, "cm"))) + theme_report() + scale_x_log10("International migrant stock (% of population)", breaks=c(1,10,20,40,60)) + scale_y_log10("TB case notification per 100 000 per year", breaks=c(5,10,50,100,150)) + scale_color_brewer("", type="qual", palette=6) + geom_text(data=subset(obd, year==max(obd$year)), aes(label=iso3), hjust=1, vjust=1.5) + theme(legend.position="none")

# direct.label(ggplot(obb, aes(mig, mig_pct, color=iso3, size=c_newinc_100k)) + geom_point() + theme_report() + scale_x_continuous("International migrant stock (% of population)") + scale_y_continuous("Foreign-born TB cases (% of total notified)") + scale_color_brewer("", type="qual", palette=6) )

# ggplot(obb, aes(c_newinc_100k, mig_pct, color=iso3, size=mig)) + geom_point() + geom_path(size=1, arrow=arrow(length=unit(0.3, "cm"))) + theme_report() + scale_x_continuous("TB case notification per 100 000 per year") + scale_y_continuous("Foreign-born TB cases (% of total notified)") + scale_color_brewer("International migrant stock (% of population)", type="qual", palette=6) + geom_text(data=subset(obd, year==max(obd$year)), aes(label=iso3), hjust=1, vjust=1.5) 



ggplot(obb, aes(year, mig_pct, ymin=0)) + geom_point(aes(size=mig)) + geom_line() + theme_report() + scale_x_continuous("", limits=c(2007,2013)) + scale_y_continuous("Foreign-born TB cases (% of total notified)") + facet_wrap(~iso3, scales = "free_y") + scale_size("International migrant stock 2010 (% of population)") + theme(legend.position="bottom")

obq <- obb %>%
  mutate(mig=ifelse(year==2010, mig, NA), mig_pct=ifelse(year==2013, mig_pct, NA)) %>%
  group_by(iso3) %>%
  summarize(mig=sum0(mig), mig_pct=sum0(mig_pct)) %>%
ggplot(aes(mig, mig_pct)) + geom_point(aes(color=iso3)) + geom_line(aes(x,y), data.frame(x=c(0,75), y=c(0,75))) + theme_report() + scale_x_continuous("International migrant stock 2010 (% of population)") + scale_y_continuous("Foreign-born TB cases 2013 (% of total notified)")
  direct.label(obq)


```

International migrant stock data from World Development Indicators, World Bank.

--------------------------------------------------------



```{r agesex-oth-data,  echo=FALSE}
figCount <- incCount(figCount, "f-agesex-oth-bar")
figCount <- incCount(figCount, "f-agesex-oth")

aga <- merge(subset(tb, year > 1999, select=c("iso3", "country", "year", "g_whoregion", "g_wpr", "newrel_m04", "newrel_m514", "newrel_m014", "newrel_m1524", "newrel_m2534", "newrel_m3544", "newrel_m4554", "newrel_m5564", "newrel_m65", "newrel_mu", "newrel_f04", "newrel_f514", "newrel_f014", "newrel_f1524",  "newrel_f2534", "newrel_f3544", "newrel_f4554", "newrel_f5564", "newrel_f65", "newrel_fu",
                                              "new_sp_m04", "new_sp_m514", "new_sp_m014", "new_sp_m1524", "new_sp_m2534", "new_sp_m3544", "new_sp_m4554", "new_sp_m5564", "new_sp_m65", "new_sp_mu", "new_sp_f04", "new_sp_f514", "new_sp_f014", "new_sp_f1524",  "new_sp_f2534", "new_sp_f3544", "new_sp_f4554", "new_sp_f5564", "new_sp_f65", "new_sp_fu",
                                              "new_sn_m04", "new_sn_m514", "new_sn_m014", "new_sn_m1524", "new_sn_m2534", "new_sn_m3544", "new_sn_m4554", "new_sn_m5564", "new_sn_m65", "new_sn_mu", "new_sn_f04", "new_sn_f514", "new_sn_f014", "new_sn_f1524",  "new_sn_f2534", "new_sn_f3544", "new_sn_f4554", "new_sn_f5564", "new_sn_f65", "new_sn_fu", 
                                              "new_ep_m04", "new_ep_m514", "new_ep_m014", "new_ep_m1524", "new_ep_m2534", "new_ep_m3544", "new_ep_m4554", "new_ep_m5564", "new_ep_m65", "new_ep_mu", "new_ep_f04", "new_ep_f514", "new_ep_f014", "new_ep_f1524",  "new_ep_f2534", "new_ep_f3544", "new_ep_f4554", "new_ep_f5564", "new_ep_f65", "new_ep_fu")), subset(p, year>1999, select=c("iso3", "country", "year", "e_pop_m04", "e_pop_m514", "e_pop_m014", "e_pop_m1524", "e_pop_m2534", "e_pop_m3544", "e_pop_m4554", "e_pop_m5564", "e_pop_m65", "e_pop_f04", "e_pop_f514", "e_pop_f014", "e_pop_f1524", "e_pop_f2534", "e_pop_f3544", "e_pop_f4554", "e_pop_f5564", "e_pop_f65")))

# Aggregate for region
agb1 <- aggregate(aga[6:ncol(aga)], by=list(year=aga$year, area=aga$g_whoregion), FUN=sum, na.rm=TRUE)

agb1[c('iso3', 'g_wpr')] <- NA
agb1$iso3 <- agb1$area
agb1$g_whoregion <- agb1$area
aga1 <- reshape::rename(aga,c('country'='area'))
agb <- rbind(aga1, agb1)

# Calculate rates

agc <- melt(agb, id=1:5)
# agc[c('new', 'type', 'group')] <- str_split_fixed(agc$variable, '_', n=3) # This takes me 25 seconds...it's the '_all' or '_fixed' that's the killer.
agc$type1 <- str_extract(agc$variable, 'newrel|pop|new_sp|new_sn|new_ep')
agc$age <- str_replace(agc$variable, "newrel_|e_pop_|new_sp_|new_sn_|new_ep_", "")
agc$sex <- str_replace(agc$age, '[u]|[0-9]+', "")
agc$age <- str_replace(agc$age, '[f]|[m]', "")

# aggregate all types for previous years
agc$type <- ifelse(agc$type1=="pop", "pop", "newrel")
agc$value <- as.numeric(agc$value) # avoid integer overflow
agd1 <- agc %>%
  group_by(iso3, area, year, g_whoregion, g_wpr, type, age, sex) %>%
  summarise(value=sum0(value)) # %>%
agd <- cast(agd1, ...~type, value = "value")

agd$newrel_100k <- agd$newrel / agd$pop * 1e5

# Subset for WPRO
age <- agd %>% filter(g_wpr=="Other", g_whoregion=="WPR", age!="u", !age %in% c("04", "514"))
age$sex <- factor(age$sex, levels=c("m", "f"), labels=c("Male", "Female"))
# age$sh.name <- factor(age$iso3, c("KHM", "CHN", "LAO", "MNG", "PNG", "PHL", "VNM", "WPR"), c("Cambodia", "China", "Lao People’s \nDemocratic Republic", "Mongolia", "Papua New Guinea", "Philippines", "Viet Nam", "WPR"))
# age[is.na(age$sh.name), 'sh.name'] <- "WPR"
age$age <- factor(age$age, c("014", "1524", "2534", "3544", "4554", "5564", "65"), c("0–14", "15–24", "25–34", "35–44", "45–54", "55–64", "\u2265 <65"))

write.csv(age, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-agesex-oth-bar", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)

write.csv(age, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-agesex-oth", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)
```

`r I(pasteLabel("Figure", figCount, "f-agesex-oth-bar"))` shows age group and sex-specific case notification rates of new laboratory-confirmed cases for the countries with a high burden of TB in the Region with available data (note that the scale of the vertical axis is different for each country). Many countries follow a typical pattern for cross-sectional observations with increasing notification rates towards older populations except in Mongolia. In general, males are more affected than females with male-to-female TB ratios as high as three as seen in Viet Nam.

--------------------------------------------------------

<a id="f-agesex-oth-bar"></a> 
**`r I(pasteLabel("Figure", figCount, "f-agesex-oth-bar", insLink=FALSE))` Age group- and sex-specific notification rates (per 100 000 population) of new and relapse TB cases in countries with a high-burden of TB in the Western Pacific Region, `r yr`**  
``` {r f-agesex-oth-bar, fig.height=11, fig.width=8, warning=FALSE}

# Workaround for non-reporting countries (so it doesn't break the plot)

age2 <- subset(age, year==yr)
age2$newrel_100k2 <- ifelse(is.na(age2$newrel_100k), 0, age2$newrel_100k)
agereport <- age2 %>% group_by(iso3) %>% summarise(var=sum(newrel_100k)) %>% filter(var>0) %>% select(iso3)
age3 <- subset(age2, iso3 %in% agereport$iso3)

p2 <- ggplot(age3, aes(age, newrel_100k, fill=sex)) + geom_bar(stat="identity", position="dodge") + facet_wrap(~iso3, scales="free_y", ncol=3)   + theme_report() + scale_fill_brewer('Sex', type="qual", palette=6) + scale_x_discrete("Age group", labels=c("0–14", "15–24", "25–34", "35–44", "45–54", "55–64", "\u2265 65")) + theme(legend.position="bottom")

p2 + scale_y_continuous("New and relapse cases per 100 000")


```


--------------------------------------------------------

<a id="f-agesex-oth"></a> 
**`r I(pasteLabel("Figure", figCount, "f-agesex-oth", insLink=FALSE))` Trend of age group- and sex-specific notification rates (per 100 000 population) of new and relapse^a^ tuberculosis cases in seven countries with a high-burden of TB in the Western Pacific Region, 2000--`r yr`**  
``` {r f-agesex-oth, warning=FALSE, fig.height=15, fig.width=8}

p1 <- ggplot(age, aes(year, newrel_100k, color=age)) + geom_line() + facet_grid(iso3~sex, scales='free_y') + theme_report() + scale_x_continuous("", breaks = pretty_breaks()) + scale_color_brewer("Age group", type="seq", palette=4)

p1 + scale_y_continuous("New and relapse cases per 100 000")
# p1 + scale_y_log10("New laboratory-confirmed cases per 100 000")                                                                                                                                                        
#function (x) floor(x)); function(n) n[floor(length(n)/5)*1:5+1]
```

^a^ Rates prior to 2013 include new cases only.

``` {r f-agesex-oth2, warning=FALSE, fig.width=8}

p1 <- ggplot(age, aes(year, newrel_100k, color=age)) + geom_line() + facet_grid(sex~iso3, scales='free_y') + theme_report() + scale_x_continuous("", breaks = pretty_breaks()) + scale_color_brewer("Age group", type="seq", palette=4)

p1 + scale_y_continuous("New and relapse cases per 100 000")
# p1 + scale_y_log10("New laboratory-confirmed cases per 100 000")                                                                                                                                                        
#function (x) floor(x)); function(n) n[floor(length(n)/5)*1:5+1]
```



Discussion
--------------------------------------------------------

```{r f-est-data}

figCount <- incCount(figCount, "f-est")

eget <- c("year", "e_pop_num", "e_inc_100k", "e_inc_100k_lo", "e_inc_100k_hi", "e_prev_100k", "e_prev_100k_lo", "e_prev_100k_hi", "e_mort_exc_tbhiv_100k", "e_mort_exc_tbhiv_100k_lo", "e_mort_exc_tbhiv_100k_hi")

# esta <- subset(estimates, year >=1990 & group_name=="WPR", select=eget)
estb <- tb[tb$year>=1990 & tb$g_whoregion=="WPR", c("year", "c_newinc")]
estc <- aggregate(estb["c_newinc"], by=list(year=estb$year), FUN=sum, na.rm=TRUE)

estd <- merge(esta, estc)

estd$c_newinc_100k <- estd$c_newinc / estd$e_pop_num * 1e5

estf <- NULL
for(var in c("inc", "prev", "mort_exc_tbhiv")){
  df <- subset(estd, select=c("year", paste0("e_", var, "_100k"), paste0("e_", var, "_100k_lo"), paste0("e_", var, "_100k_hi")))
  names(df) <- c("year", "best", "lo", "hi")
  df$var <- var
  estf <- rbind(estf, df)
  }

estg <- estd[c("year", "c_newinc_100k")]
estg$var <- "inc"

esth <- merge(estf, estg, all.x=TRUE)
esth$var <- factor(esth$var, levels=c("inc", "prev", "mort_exc_tbhiv"), labels=c("Incidence and notification", "Prevalence", "Mortality (excluding HIV)"))

write.csv(esth, file=paste0(pasteLabel("./figure_data/figure", figCount, "f-est", insLink=FALSE, sepper=""), ".csv"), row.names=FALSE)

# for paragraph
d1 <- estd %>% filter(year==yr) %>% mutate(c=signif(c_newinc / 1e6, 2), r=signif(c_newinc_100k,2)) %>% select(c, r)

  
```

Overall, in `r yr`, countries and areas of the Western Pacific Region reported `r d1$c` million new and relapse TB cases (all forms) and a case notification rate of `r d1$r` per 100 000 population, a level similar to the past several years.

It has been known that the rapid increase in case notification between 2002 and 2007 was due to several positive programmatic developments in many countries in the Region such as completion and consolidation of the WHO DOTS strategy expansion; improvement in case reporting, including electronic reporting systems; and efforts to engage all health care providers.[@VanMaaren2007] Particularly, renewal of infectious disease-related legislation and the establishment of an internet-based disease notification system in China made a substantial contribution to the progress.[@Wang2007]

Although the case notification for all forms of TB appears to be flat since 2007, it is important to note that the new laboratory-confirmed case notification rates demonstrate a clear declining trend (`r I(pasteLabel("Figure", figCount, "f-notif-trend"))`). A possible interpretation is that the true TB incidence has been declining while overall case detection is static because intensified programmatic efforts by national TB programmes for early and increased case detection include smear-negative and extra pulmonary TB. The latest WHO estimates support this explanation with estimated incidence rates showing a consistent, rapidly-declining trend[@WorldHealthOrganization2014] (`r I(pasteLabel("Figure", figCount, "f-est"))`). 

--------------------------------------------------------

<a id="f-est"></a> 
**`r I(pasteLabel("Figure", figCount, "f-est", insLink=FALSE))` Tuberculosis case notification rate per 100 000 population, estimated incidence^a^, prevalence and mortality in the Western Pacific Region, 1990--`r yr`**  
``` {r f-est, fig.height=3.5}

ggplot(esth, aes(year, best, fill=var, ymin=0)) + geom_line(size=1, aes(color=var)) + geom_ribbon(aes (year, best, ymin=lo, ymax=hi), alpha=0.2) + geom_line(aes(year, c_newinc_100k), color="black", size=1) + theme_report() + facet_wrap(~var, scales="free_y") + theme(legend.position="none") + scale_x_continuous("", minor_breaks=seq(1990, yr, 1)) + scale_y_continuous(breaks=pretty_breaks()) + ylab("Rate per 100 000 population")

#breaks=c(seq(1990, 2010, 5), yr), labels=c(seq(1990, 2005, 5),"", yr)
```

^a^ Red line with uncertainty band: incidence, black line: notified new and relapse cases.

--------------------------------------------------------

In any country where a rapid demographic change is underway, overall notification rates may not reflect the true disease trend in communities. For instance, an overall case notification trend may appear to be stable because decreasing incidences can be cancelled out by a rapidly increasing proportion of the older population. For this reason, the examination of age- and sex- specific case notification rates is more informative and provides insights for understanding the underlying epidemiological process in a given setting.

The typical pattern of linear increase of notification towards the older populations (such as shown in some countries in `r I(pasteLabel("Figure", figCount, "f-agesex-bar"))`) has been explained as a widely observed phenomena under a stable TB control situation,[@Rieder1999] reflecting a high annual risk of TB infection in the past when the older population was young. Atypical patterns shown for Papua New Guinea and Mongolia, particularly relatively high notification rates among young and female groups, warrant further investigation. Time trend analysis for age- and sex- notification rates (`r I(pasteLabel("Figure", figCount, "f-agesex"))`) is useful to detect any specific subgroups among which TB transmission and/or disease progression is particularly active.

One of the critical shortcomings of these analyses is a gross lack of morbidity information among small children because the data is limited to laboratory-confirmed cases only. Since the 2006 revision of WHO recording and reporting forms,[@WorldHealthOrganization2006] the number of countries reporting age- and sex-disaggregated data for smear-negative and extra pulmonary cases is increasing and will enable a better assessment of the TB burden among children in future analysis.

HIV infection fuels the TB epidemic, particularly in countries and areas with a high burden of TB. The overall percentage of TB patients tested for HIV in the Region still remained low. However, the figure has substantially increased in the last several years particularly in Cambodia, Viet Nam and the Lao People's Democratic Republic. Essential services such as co-trimoxazole prophylaxis and isoniazid preventive therapy have also expanded in many countries in the Region.

This report provides a snapshot of the epidemiological and programmatic situation of TB in the Western Pacific Region based on the case notification data in `r yr`. As for any disease surveillance system, the analysis of surveillance data has inherent limitations. TB surveillance covers populations served by care providers linked with the national TB programme. Ideally this would include all known cases in the country; in practice the proportion of cases diagnosed outside of the TB programme and included in national reporting varies depending on the legal framework in the country. The WHO TB Impact Measurement Task Force recommends that countries continuously improve surveillance systems until reported cases can be considered a reliable proxy for incidence.[@WorldHealthOrganization2009; @WorldHealthOrganization2014b] A careful assessment is needed of programmatic progress in the country and the quality of surveillance data when interpreting these findings.

TB surveillance continues to be an important source of information for assessing the situation and measuring the progress for decision-making. WHO Regional Office for the Western Pacific will continue to conduct regional analyses on various topics related to TB epidemiology and programmatic progress, as well as provide support to countries to conduct epidemiological and programmatic assessment at national and subnational levels.

--------------------------------------------------------

**<em>Funding</em>**

None.

--------------------------------------------------------

**<em>Conflict of interest</em>**

None declared.

--------------------------------------------------------

**<em>Acknowledgement</em>**

The authors are very grateful to the national tuberculosis control programmes of the countries of the Western Pacific Region.

--------------------------------------------------------

**<em>References:</em>**

```{r, include=FALSE, echo=FALSE}
# Bit to copy html file over
# file.copy("D:/Users/hiattt/Dropbox/Code/Surveillance reports/RegTBfigsTables.html", "D:/Users/hiattt/Dropbox/STB-WPRO/WPSAR surveillance paper/WPRupdate.html", overwrite = TRUE)
```
